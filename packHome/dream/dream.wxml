<global-background>
  <custom-navbar title="ormkornnaphat" showBack="{{true}}" showHome="{{false}}"></custom-navbar>
  <view class="container" style="margin-top: {{navBarHeight}}px;height:calc(100vh - {{navBarHeight}}px);">
    <!-- 标签页切换 -->
    <view class="tabs" style="top: {{navBarHeight}}px;">
      <view class="tab-item {{activeTab === 'ranking' ? 'active' : ''}}" data-tab="ranking" bindtap="switchTab">
        <text>排行榜</text>
      </view>
      <view class="tab-item {{activeTab === 'photos' ? 'active' : ''}}" data-tab="photos" bindtap="switchTab">
        <text>风格照片</text>
      </view>
    </view>
    <!-- 排行榜内容 -->
    <view class="content" wx:if="{{activeTab === 'ranking'}}">
      <!-- 前三名展示区域 -->
      <view class="top-three-container" wx:if="{{rankingList.length > 0}}">
        <view class="top-three-content">
          <!-- 第一名 -->
          <view class="top-item" wx:if="{{rankingList.length > 0}}" bindtap="showModal" data-index="0">
            <image wx:if="{{rankingList[0].imageUrl}}" class="top-avatar" src="{{rankingList[0].imageUrl}}" mode="widthFix" lazy-load="{{true}}"></image>
            <view class="top-info">
              <image wx:if="{{rankingList[0].userAvatar}}" class="first-avatar" src="{{rankingList[0].userAvatar}}" mode="widthFix" lazy-load="{{true}}"></image>
              <view class="top-name">{{rankingList[0].style}}</view>
              <view class="top-likes">{{rankingList[0].likes}} 点赞</view>
            </view>
          </view>
        </view>
      </view>
      <view class="ranking-list">
        <view class="list-header">
          <text class="header-rank">排名</text>
          <text class="header-user">用户</text>
          <text class="header-score">点赞</text>
          <text class="header-photos">照片</text>
        </view>
        <block wx:for="{{rankingList}}" wx:key="_id" wx:for-index="index" wx:for-item="item">
          <!-- 从第2名开始显示 -->
          <view wx:if="{{index >= 1}}" class="ranking-item" bindtap="showModal" data-index="{{index}}">
            <view class="rank-number">
              <text>{{index + 1}}</text>
            </view>
            <view class="user-info">
              <image class="user-avatar" src="{{item.userAvatar}}" mode="aspectFill" lazy-load="{{true}}"></image>
              <text class="user-name">{{item.userName}}</text>
            </view>
            <text class="score">{{item.likes}}</text>
            <view class="photos-contens">
              <image class="photos-count" src="{{item.imageUrl}}" mode="aspectFill" lazy-load="{{true}}"></image>
            </view>
          </view>
        </block>
        <view wx:if="{{rankingList.length === 0}}" class="empty-state">
          <text>暂无排行榜数据</text>
        </view>
      </view>
    </view>
    <!-- 排行榜详情弹窗 -->
    <view class="ranking-modal {{showModal ? 'show' : ''}}" bindtap="hideModal">
      <view class="modal-content">
        <view class="modal-header">
          <text class="modal-title">排行榜详情</text>
          <view class="close-btn" bindtap="hideModal">×</view>
        </view>
        <view class="modal-body">
          <view class="user-info-section">
            <image class="modal-user-avatar" src="{{selectedItem.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill" lazy-load="{{true}}"></image>
            <view class="user-details">
              <text class="modal-user-name">{{selectedItem.userName || '未知用户'}}</text>
              <text class="modal-rank">排名: {{selectedItem.rank}}</text>
            </view>
          </view>
          <view class="photo-section">
            <image class="modal-photo" src="{{selectedItem.imageUrl}}" mode="widthFix" bindtap="viewPhotoInModal" lazy-load="{{true}}"></image>
          </view>
          <view class="stats-section">
            <view class="stat-item">
              <text class="stat-label">点赞数</text>
              <text class="stat-value">{{selectedItem.likes || 0}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">风格</text>
              <text class="stat-value">{{selectedItem.style || '未分类'}}</text>
            </view>
          </view>
          <view class="description-section">
            <text class="description-label">描述:</text>
            <text class="description-text">{{selectedItem.description || '暂无描述'}}</text>
          </view>
          <view class="like-btn {{selectedItem.isLiked ? 'liked' : ''}}" catchtap="likePhotoInModal">
            {{selectedItem.isLiked ? '已点赞' : '点赞'}}
          </view>
        </view>
      </view>
    </view>
    <!-- 风格照片内容 -->
    <view class="content" wx:if="{{activeTab === 'photos'}}">
      <view class="style-groups">
        <block wx:for="{{groupedPhotos}}" wx:for-item="photos" wx:for-index="style" wx:key="style">
          <view class="style-group" bindtap="viewStyleDetail" data-style="{{style}}">
            <image src="{{groupedPhotos[style][0].imageUrl}}" mode="aspectFill" class="style-group-img" />
            <view class="style-header">
              <text class="style-title">{{style}}</text>
              <text>{{groupedPhotos[style].length}}张</text>
            </view>
          </view>
        </block>
        <view wx:if="{{Object.keys(groupedPhotos).length === 0}}" class="empty-state">
          <text>暂无照片</text>
        </view>
      </view>
      <!-- 底部装饰 -->
      <view class="bottom-decoration">
        <text class="school-motto">知识改变命运，学习成就未来</text>
      </view>
    </view>
  </view>
</global-background>