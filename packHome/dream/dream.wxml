<global-background>
  <custom-navbar title="ormkornnaphat" showBack="{{true}}" showHome="{{false}}"></custom-navbar>
  <view class="container" style="margin-top: {{navBarHeight}}px;min-height:calc(100vh - {{navBarHeight}}px);">
    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <view class="tabs">
      <view class="tab-item {{activeTab === 'ranking' ? 'active' : ''}}" data-tab="ranking" bindtap="switchTab">
        <text>æ’è¡Œæ¦œ</text>
      </view>
      <view class="tab-item {{activeTab === 'photos' ? 'active' : ''}}" data-tab="photos" bindtap="switchTab">
        <text>é£æ ¼ç…§ç‰‡</text>
      </view>
      <view class="tab-item {{activeTab === 'submit' ? 'active' : ''}}" data-tab="submit" bindtap="switchTab">
        <text>æˆ‘è¦æŠ•ç¨¿</text>
      </view>
      <view class="tab-item {{activeTab === 'myphotos' ? 'active' : ''}}" data-tab="myphotos" bindtap="switchTab">
        <text>æˆ‘çš„æŠ•ç¨¿</text>
      </view>
    </view>
    <!-- æ’è¡Œæ¦œå†…å®¹ -->
    <view class="content" wx:if="{{activeTab === 'ranking'}}">
      <view class="ranking-list">
        <view class="list-header">
          <text class="header-rank">æ’å</text>
          <text class="header-user">ç”¨æˆ·</text>
          <text class="header-score">ç‚¹èµ</text>
          <text class="header-photos">ç…§ç‰‡</text>
        </view>
        <block wx:for="{{rankingList}}" wx:key="_id">
          <view class="ranking-item {{index < 3 ? 'top-three' : ''}}">
            <view class="rank-number">
              <text wx:if="{{index === 0}}" class="gold">ğŸ¥‡</text>
              <text wx:if="{{index === 1}}" class="silver">ğŸ¥ˆ</text>
              <text wx:if="{{index === 2}}" class="bronze">ğŸ¥‰</text>
              <text wx:if="{{index > 2}}">{{item.rank}}</text>
            </view>
            <view class="user-info">
              <image class="user-avatar" src="{{item.userAvatar}}" mode="aspectFill"></image>
              <text class="user-name">{{item.userName}}</text>
            </view>
            <text class="score">{{item.likes}}</text>
            <image class="photos-count" src="{{item.imageUrl}}" mode="widthFix" lazy-load="{{true}}"></image>
            <!-- <text class="photos-count">{{item.imageUrl}}</text> -->
          </view>
        </block>
        <view wx:if="{{rankingList.length === 0}}" class="empty-state">
          <text>æš‚æ— æ’è¡Œæ¦œæ•°æ®</text>
        </view>
      </view>
    </view>
    <!-- é£æ ¼ç…§ç‰‡å†…å®¹ -->
    <view class="content" wx:if="{{activeTab === 'photos'}}">
      <view class="photo-grid">
        <block wx:for="{{approvedPhotos}}" wx:key="_id">
          <view class="photo-item">
            <view class="photo-preview" bindtap="viewPhoto" data-image="{{item.imageUrl}}">
              <image class="photo-image" src="{{item.imageUrl}}" mode="aspectFill"></image>
            </view>
            <view class="photo-info">
              <text class="photo-name">{{item.style}}</text>
              <view class="like-section {{likedPhotoIds.indexOf(item._id) !== -1 ? 'liked' : ''}}" data-id="{{item._id}}" bindtap="likePhoto">
                <text class="like-count">{{item.likes || 0}}</text>
                <text class="heart">â¤ï¸</text>
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{approvedPhotos.length === 0}}" class="empty-state">
          <text>æš‚æ— å®¡æ ¸é€šè¿‡çš„ç…§ç‰‡</text>
        </view>
      </view>
    </view>
    <!-- æŠ•ç¨¿å†…å®¹ -->
    <view class="content" wx:if="{{activeTab === 'submit'}}">
      <view class="submit-form">
        <view class="form-section">
          <text class="section-title">é€‰æ‹©é£æ ¼</text>
          <view class="style-options">
            <block wx:for="{{styleOptions}}" wx:key="index">
              <view class="style-option {{submissionForm.style === item ? 'selected' : ''}}" data-style="{{item}}" bindtap="selectStyle">
                <text>{{item}}</text>
              </view>
            </block>
          </view>
        </view>
        <view class="form-section">
          <text class="section-title">ä¸Šä¼ ç…§ç‰‡</text>
          <view class="upload-section" bindtap="chooseImage">
            <view wx:if="{{!submissionForm.image}}" class="upload-placeholder">
              <text>ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</text>
            </view>
            <image wx:if="{{submissionForm.image}}" class="uploaded-image" src="{{submissionForm.image}}" mode="aspectFill"></image>
          </view>
        </view>
        <view class="form-section">
          <text class="section-title">ç…§ç‰‡æè¿°</text>
          <textarea class="description-input" placeholder="è¯·è¾“å…¥ç…§ç‰‡æè¿°..." value="{{submissionForm.description}}" bindinput="inputDescription"></textarea>
        </view>
        <view class="cooldown-info" wx:if="{{!canSubmit}}">
          <text>æ‚¨ä»Šå¤©å·²æŠ•ç¨¿ï¼Œè¯·æ˜å¤©å†æ¥</text>
        </view>
        <button class="submit-btn" bindtap="submitPhoto" disabled="{{!canSubmit || !userInfo}}">
          {{canSubmit && userInfo ? 'æäº¤æŠ•ç¨¿' : (userInfo ? 'ä»Šæ—¥å·²æŠ•ç¨¿' : 'è¯·å…ˆç™»å½•')}}
        </button>
      </view>
    </view>
    <!-- æˆ‘çš„æŠ•ç¨¿å†…å®¹ -->
    <view class="content" wx:if="{{activeTab === 'myphotos'}}">
      <view class="my-photos-list">
        <view wx:if="{{userPhotos.length === 0}}" class="empty-state">
          <text>æ‚¨è¿˜æ²¡æœ‰æŠ•ç¨¿ä»»ä½•ç…§ç‰‡</text>
        </view>
        <block wx:for="{{userPhotos}}" wx:key="_id">
          <view class="photo-card">
            <image class="photo-img" src="{{item.imageUrl}}" mode="aspectFill" bindtap="viewPhoto" data-image="{{item.imageUrl}}"></image>
            <view class="photo-details">
              <view class="photo-meta">
                <text class="photo-style">é£æ ¼ï¼š{{item.style}}</text>
                <text class="photo-status {{item.status === 'approved' ? 'status-approved' : (item.status === 'pending' ? 'status-pending' : 'status-rejected')}}">
                  {{item.status === 'approved' ? 'å·²é€šè¿‡' : (item.status === 'pending' ? 'å®¡æ ¸ä¸­' : 'å·²æ‹’ç»')}}
                </text>
              </view>
              <text class="photo-desc">{{item.description}}</text>
              <text class="photo-time">{{item.createTime}}</text>
              <view class="photo-actions">
                <button class="action-btn view-btn" bindtap="viewPhoto" data-image="{{item.imageUrl}}">
                  æŸ¥çœ‹
                </button>
                <button class="action-btn delete-btn" bindtap="deletePhoto" data-id="{{item._id}}">
                  åˆ é™¤
                </button>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>
</global-background>