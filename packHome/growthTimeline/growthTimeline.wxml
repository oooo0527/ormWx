<global-background>
  <custom-navbar title="ormkornnaphat" showBack="{{true}}" showHome="{{false}}"></custom-navbar>
  <view class="container" style="margin-top: {{navBarHeight}}px;height:calc(100vh - {{navBarHeight}}px);">
    <!-- 星空背景 -->
    <view class="star-background">
      <image src="../../pages/Home/1.jpg" class="star-background-image" lazy-load mode="widthFix"></image>
      <block wx:for="{{stars}}" wx:key="id">
        <view class="star" style="left: {{item.x}}%; top: {{item.y}}%; width: {{item.size}}px; height: {{item.size}}px; opacity: {{item.opacity}};"></view>
      </block>
    </view>
    <!-- 时间线容器 -->
    <scroll-view class="timeline-container" scroll-y="true" bindscrolltolower="onScrollToLower" wx-if="{{showBg}}">
      <!-- 垂直时间线 -->
      <view class="vertical-timeline">
        <block wx:for="{{timelineData}}" wx:key="id">
          <!-- 左侧时间点 -->
          <view class="timeline-item left" wx:if="{{index % 2 === 0}}" data-index="{{index}}">
            <view class="timeline-content" bindtap="onTapTimelineContent" data-index="{{index}}">
              <view class="timeline-date">{{item.year}} {{item.month}}</view>
              <view class="timeline-title">{{item.title}}</view>
              <view class="timeline-desc">{{item.description}}</view>
            </view>
            <view class="timeline-marker" bindtap="onTapTimelineMarker" data-index="{{index}}"></view>
          </view>
          <!-- 右侧时间点 -->
          <view class="timeline-item right" wx:else data-index="{{index}}">
            <view class="timeline-marker" bindtap="onTapTimelineMarker" data-index="{{index}}"></view>
            <view class="timeline-content" bindtap="onTapTimelineContent" data-index="{{index}}">
              <view class="timeline-date">{{item.year}} {{item.month}}</view>
              <view class="timeline-title">{{item.title}}</view>
              <view class="timeline-desc">{{item.description}}</view>
            </view>
          </view>
          <!-- 时间点详情弹窗 -->
          <view class="detail-modal {{showDetailModal && currentDetailIndex === index ? 'show' : ''}}">
            <view class="detail-content">
              <view class="detail-header">
                <text class="detail-title">{{item.title}}</text>
                <view class="close-btn" bindtap="onCloseDetail">×</view>
              </view>
              <view class="detail-body">
                <text class="detail-time">{{item.year}} {{item.month}}</text>
                <text class="detail-description">{{item.description}}</text>
              </view>
            </view>
          </view>
        </block>
      </view>
      <!-- 底部提示 -->
      <view class="footer-tip">滚动到底部，给Orm送上你的祝福</view>
    </scroll-view>
    <!-- 祝福输入弹窗 -->
    <view class="blessing-modal {{showBlessingModal ? 'show' : ''}}">
      <view class="blessing-content">
        <view class="blessing-header">
          <text class="blessing-title">To: ORM</text>
          <view class="close-btn" bindtap="onCloseBlessingModal">×</view>
        </view>
        <view class="blessing-body">
          <textarea class="blessing-input" placeholder="请输入你想对Orm说的话..." maxlength="10" value="{{blessingText}}" bindinput="onBlessingInput"></textarea>
          <button class="submit-btn" bindtap="onSubmitBlessing">谢谢你成为orm</button>
        </view>
      </view>
    </view>
    <!-- 祝福展示弹窗（每个祝福一个弹窗） -->
    <block wx:for="{{blessingItems}}" wx:key="id">
      <view class="single-blessing-modal {{item.show ? 'show' : ''}}" style="z-index: {{200 + item.id}};">
        <view class="single-blessing-content {{item.animationClass}} {{item.show ? 'animate' : ''}}" style="top: {{item.top}}px; left: {{item.left}}px;">
          <text class="blessing-text1">我的大明星</text>
          <text class="blessing-text">{{item.text}}</text>
        </view>
      </view>
    </block>
  </view>
</global-background>