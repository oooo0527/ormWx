# 部署指南

本文档介绍了如何部署微信小程序及其云函数。

## 前置条件

1. 已安装微信开发者工具
2. 已在微信公众平台注册小程序账号
3. 已开通云开发功能

## 部署步骤

### 1. 导入项目

1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择项目根目录
4. 输入 AppID（或使用测试号）

### 2. 部署云函数

1. 在微信开发者工具中，展开`cloudfunctions`目录
2. 分别右键点击以下云函数目录：
   - `fanVoice`
   - `initDatabase`
3. 选择"上传并部署：云端安装依赖"
4. 等待部署完成

### 3. 初始化数据库

1. 在微信开发者工具顶部菜单中，点击"云开发"
2. 进入"数据库"标签页
3. 点击"新建集合"，创建以下集合：
   - `interactions`
   - `comments`
   - `replies`
   - `favorites`
4. 进入"云函数"标签页
5. 分别调用`initDatabase`云函数的以下方法来初始化数据：
   - `initInteractionsCollection`
   - `initCommentsCollection`
   - `initRepliesCollection`

### 4. 配置权限

1. 在云开发控制台中，进入"数据库"标签页
2. 为每个集合设置适当的权限：
   - `interactions`: 所有用户可读，仅创建者可写
   - `comments`: 所有用户可读，仅创建者可写
   - `replies`: 所有用户可读，仅创建者可写
   - `favorites`: 仅创建者可读写

## 测试功能

1. 编译并预览小程序
2. 登录账户
3. 发表一条互动留言
4. 使用另一个账户对该留言进行评论
5. 再使用第三个账户对评论进行回复
6. 检查消息中心是否收到了评论和回复通知

## 常见问题

### 云函数部署失败

- 检查网络连接
- 确认云函数目录中包含正确的`package.json`文件
- 确认云开发环境已正确配置

### 数据库初始化失败

- 检查是否已创建相应的集合
- 确认云函数具有足够的权限访问数据库

### 通知功能不工作

- 检查`addComment`云函数是否正确保存了评论到`comments`集合
- 检查`addCommentReply`云函数是否正确保存了回复到`replies`集合
- 确认`getUserComments`和`getUserReplyNotifications`云函数能够正确查询到相应的通知